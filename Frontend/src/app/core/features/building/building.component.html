<div class="container">
  <div class="level">
    <div class="level-left">
      <h2 class="title is-3 mb-5">Edificios</h2>
    </div>
    <div class="level-right">
      <button class="button" (click)="create()">
        <span class="icon mr-1">
          <i class="fa-solid fa-plus"></i>
        </span>
        Agregar Edificio
      </button>
    </div>
  </div>
</div>

@if (isLoading) {
<div CLASS="container mt-4">
  <div class="skeleton-block">
    Lorem ipsum dolor sit amet consectetur adipisicing elit. Soluta laborum
    mollitia perferendis, id molestias dolor eaque architecto maxime. Repudiandae
    repellat, voluptates quo totam natus iusto molestias soluta. Nihil, aspernatur
    praesentium! Repellendus nihil, culpa quam a quae distinctio facilis sint
    corporis incidunt aspernatur quos et sed amet placeat vel atque, autem
    pariatur asperiores nobis, iusto laborum magni illo beatae! Placeat, minus.
    Optio saepe eius repellendus tempore vel adipisci et corporis illo expedita
    veniam, cupiditate blanditiis accusamus libero ut minima ratione eligendi
    neque. Enim, autem sit repudiandae vel saepe natus ipsum impedit! In soluta
    facere ad deleniti sit hic rem fugit modi ut dicta. Nam error delectus
    molestias eius quisquam ullam at in dolorem ratione ducimus repudiandae quis
    consectetur neque, eos eaque? Officiis ea quis aliquam asperiores placeat.
    Maxime eligendi obcaecati facere nisi ipsum. Nesciunt accusamus ex laboriosam
    esse! Sapiente, eos odio eius unde provident dicta praesentium accusamus,
    dolore doloremque deleniti consectetur? Velit necessitatibus, aliquid ut
    cumque hic doloribus illo rem eius autem magnam vel non, consectetur molestias
  </div>
</div>
} @else {
  <div CLASS="container mt-4">
    <div class="tabs">
      <ul>
        @for (building of Edificios; track building.id) {
          <li
            [class.is-active]="building.id === selectedBuildingId"
            (click)="detail(building.id)"
          >
            <a>{{ building.name }}</a>
          </li>
        }
      </ul>
    </div>
  </div>

  <div CLASS="container">
    <form class="box" [formGroup]="buildingForm">
    <div class="columns">
      <div class="column field is-6">
        <label class="label" for="nombre">Nombre Edificio</label>
        <div class="control">
          <input
            class="input"
            id="nombre"
            type="text"
            formControlName="nombreEdificio"
            (input)="onInputChange('nombreEdificio')"
            [ngClass]="{
              'is-danger':
                buildingForm.get('nombreEdificio')?.invalid &&
                buildingForm.get('nombreEdificio')?.touched,
                'is-success':
                buildingForm.get('nombreEdificio')?.valid &&
                buildingForm.get('nombreEdificio')?.touched
            }"
          />
          @if (buildingForm.get('nombreEdificio')?.invalid &&
          buildingForm.get('nombreEdificio')?.touched) {
          <p class="help is-danger">
            <i class="fas fa-exclamation-triangle"></i>
            Debe ingresar el nombre del Edificio.
          </p>
          } @else if (buildingForm.get('nombreEdificio')?.valid &&
          buildingForm.get('nombreEdificio')?.touched) {
          <p class="help is-right">
            <i class="fas fa-check"></i>
            Validado
          </p>
          }
        </div>
      </div>

      @if (!isCreation) {
      <div class="column field is-6">
        <label class="label" for="nombrecomunidad">Nombre Comunidad</label>
        <div class="control">
          <input
            class="input"
            id="nombrecomunidad"
            type="text"
            formControlName="ComunidadEdificio"
          />
        </div>
      </div>
      }
    </div>

    <div class="columns">
      <div class="column field is-6">
        <label class="label" for="cantidadpisos">N° de Pisos</label>
        <div class="control">
          <input
            class="input"
            id="cantidadpisos"
            type="number"
            formControlName="pisosEdificio"
            (input)="onInputChange('pisosEdificio')"
            [ngClass]="{
              'is-danger':
                buildingForm.get('pisosEdificio')?.invalid &&
                buildingForm.get('pisosEdificio')?.touched,
                'is-success':
                buildingForm.get('pisosEdificio')?.valid &&
                buildingForm.get('pisosEdificio')?.touched
            }"

          />
          @if (buildingForm.get('pisosEdificio')?.invalid &&
          buildingForm.get('pisosEdificio')?.touched) {
          <p
            class="help is-danger"
            *ngIf="buildingForm.get('pisosEdificio')?.invalid"
          >
            <i class="fas fa-exclamation-triangle"></i>
            El edificio debe tener al menos 1 piso.
          </p>
          } @else if (buildingForm.get('pisosEdificio')?.valid &&
          buildingForm.get('pisosEdificio')?.touched) {
          <p class="help is-right">
            <i class="fas fa-check"></i>
            Validado
          </p>
          }
        </div>
      </div>

      @if (!isCreation) {
      <div class="column field is-6">
        <label class="label" for="cantidadunidades">N° de Unidades</label>
        <div class="control">
          <input
            class="input"
            id="cantidadunidades"
            type="text"
            formControlName="CantidadUnidades"
          />
        </div>
      </div>
      }
    </div>

    @if (!notification) { } @else {
    <div class="notification is-danger">
      <button class="delete" (click)="closeNotification()"></button>
      No es posible eliminar Edificio,
      <strong>existen unidades asociadas</strong>.
    </div>
    } @if (postUpdateOrCreate && isCreation) {
    <div class="notification is-success">
      <button class="delete" (click)="closeNotification()"></button>
      Edificio creado exitosamente.
    </div>
    } @else if (postUpdateOrCreate && isEdited) {
    <div class="notification is-success">
      <button class="delete" (click)="closeNotification()"></button>
      Edificio actualizado exitosamente.
    </div>
    } @else if (postUpdateOrCreate && isDeletion) {
    <div class="notification is-success">
      <button class="delete" (click)="closeNotification()"></button>
      Edificio eliminado exitosamente.
    </div>
    } @if (errors) {
    <div class="message is-danger">
      <div class="message-body">
        @for(error of errors; track $index){
        {{ error.message }}

        }
      </div>
    </div>
    }

    <div class="buttons">
      @if (isEdited) {
      <button
        type="submit"
        class="button is-primary"
        (click)="update()"
        [disabled]="!buildingForm.valid"
        [ngClass]="{
          'is-loading': isSubmit
        }"
      >
        Guardar
      </button>
      <button class="button is-link" (click)="exitdit()">Cancelar</button>
      } @else if (isCreation){
      <button
        type="submit"
        class="button is-primary"
        (click)="saveCreate()"
        [ngClass]="{ 'is-loading': loading }"
        [disabled]="buildingForm.invalid || !canSend"
      >
        Guardar
      </button>
      <button
        class="button is-link"
        [disabled]="loading"
        (click)="exitcreation()"
      >
        Cancelar
      </button>
      } @else {
      <button class="button" (click)="edit()"><span class="icon mr-2"><i class="mr-2 fa-solid fa-pen-to-square"></i></span>Editar</button>
      <button class="button" (click)="openmodal()"><span class="icon mr-2"><i class="mr-2 fa-solid fa-trash"></i></span>Eliminar</button>
      }
    </div>
  </form>
  </div>
  <div class="container">
    <app-unit
      buildingId="{{ selectedBuildingId }}"
      buildingName="{{ Edificio.name }}"
    />
  </div>

<div class="modal" [ngClass]="{ 'is-active': ActivateModal }">
  <div class="modal-background"></div>
  <div class="modal-card">
    <header class="modal-card-head is-shadowless">
      <p class="modal-card-title">
        Eliminando edificio {{ this.Edificio.name }}
      </p>
      <button class="delete" style="background: none" aria-label="close" (click)="closemodal()"></button>
    </header>
    <section class="modal-card-body">
      <p>
        Eliminará el edificio {{ this.Edificio.name }} de
        {{ this.Edificio.communityName }}, esta acción no se puede revertir, debe confirmar la acción:
      </p>
    </section>
    <footer class="modal-card-foot">
      <div class="buttons">
        <button
          class="button is-danger"
          (click)="deletebuilding()"
          [ngClass]="{ 'is-loading': loading }"
        >
          Confirmar
        </button>
        <button class="button" (click)="closemodal()">Salir</button>
      </div>
    </footer>
  </div>
</div>

}
